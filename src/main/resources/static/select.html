<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>选择需要的课程</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.min.css">
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.theme.min.css">
    <link rel="stylesheet" type="text/css" href="css/jquery-ui.structure.min.css">
    <script type="text/javascript" src="js/jquery-3.4.0.min.js"></script>
    <script type="text/javascript" src="js/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
    <script type="text/javascript">
        function getMajorList(gradeId){
            var majors=$("#majorList");
            majors.empty();

            if(gradeId===""){
                majors.append('<option value="">请先选择年级</option>');
                majors.attr("disabled","disabled");
            }else{
                majors.removeAttr('disabled');
                $.getJSON("majors/"+gradeId,function (result) {
                    for(var i in result){
                        if(result[i].hasOwnProperty('majorId') && result[i].hasOwnProperty('majorName')) {
                            majors.append('<option value=' + result[i]['majorId'] + '>' + result[i]['majorName']  + '</option>');
                        }
                    }
                })
            }
        }
        function deleteOneCourse(courseId){
            var chosenCourseTable = document.getElementById("chosenCourses");
            for(var r = 0;r<chosenCourseTable.rows.length;++r)
                if(courseId == chosenCourseTable.rows[r].cells[0].innerHTML){
                chosenCourseTable.deleteRow(r);
                if(chosenCourseTable.rows.length === 0){
                    document.getElementById("next").setAttribute("disabled","disabled");
                }
                return;
            }
        }
        function addOneCourse(courseId,courseName) {
            var chosenCourseTable = document.getElementById('chosenCourses');
            document.getElementById("next").removeAttribute("disabled");
            for(var r = 0;r<chosenCourseTable.rows.length;++r)
                if(courseId === chosenCourseTable.rows[r].cells[0].innerHTML)return;
            var newRow = chosenCourseTable.insertRow();
            newRow.innerHTML='<td>'+courseId+'</td><td>'+courseName+'</td><td><input type = button class="btn btn-danger btn-xs" value = "删除" onclick = deleteOneCourse("'+courseId+'")></td>';
            newRow.setAttribute('class','success');
        }
        function getCoursesByName(name){
            var inputName = $('#courseNameDiv');
            if(name.length === 0){
                inputName.addClass("has-error");
                $('#inputCourseName').attr("placeholder","课程名称不能为空");
            }else{
                inputName.removeClass("has-error");
                inputName.addClass("has-success");
                var tableBody=$("#courseListForChoose");
                tableBody.empty();
                $.getJSON("courses/name="+name,function (result) {
                    if(result.length === 0){
                        tableBody.append(
                            "                <tr class='text-center'>\n" +
                            "                    <td colspan='5'>\n" +
                            "                        <div class='alert alert-warning'>\n" +
                            "                            未检索到名字包含'"+name+"'的课程。\n" +
                            "                        </div>\n" +
                            "                    </td>\n" +
                            "                </tr>\n");
                    }
                    else
                    for(var i in result){
                        tableBody.append("<tr class='info'>"+
                            "<td>"+result[i]['courseId']+"</td>"+
                            "<td>"+result[i]['name']+"</td>"+
                            "<td>"+result[i]['credit']+"</td>"+
                            "<td>"+result[i]['faculty']+"</td>"+
                            "<td><input type='button' class='btn btn-success btn-xs' onclick='addOneCourse(\""+result[i]['courseId']+"\",\""+result[i]['name']+"\")' value='点击选择'/></td>"+
                            "</tr>"
                        )
                    }
                })
            }
        }
        function getCoursesByPlan(grade,major,semester){
            var tableBody=$("#courseListForChoose");
            tableBody.empty();
            if(grade==='' || major===''){
                tableBody.append(
                    "                <tr class='text-center'>\n" +
                    "                    <td colspan='5'>\n" +
                    "                        <div class='alert alert-warning'>\n" +
                    "                            年级和专业序号不能为空。\n" +
                    "                        </div>\n" +
                    "                    </td>\n" +
                    "                </tr>\n");
            }else{
                $.getJSON("courses/plan~"+grade+"="+major+"="+semester,function (result) {
                    if(result.length === 0){
                        tableBody.append(
                            "                <tr class='text-center'>\n" +
                            "                    <td colspan='5'>\n" +
                            "                        <div class='alert alert-warning'>\n" +
                            "                            根据以上条件未找到课程。\n" +
                            "                        </div>\n" +
                            "                    </td>\n" +
                            "                </tr>\n");
                    }
                    else
                        for(var i in result){
                            tableBody.append("<tr class='info'>"+
                                "<td>"+result[i]['courseId']+"</td>"+
                                "<td>"+result[i]['name']+"</td>"+
                                "<td>"+result[i]['credit']+"</td>"+
                                "<td>"+result[i]['faculty']+"</td>"+
                                "<td><input type='button' class='btn btn-success btn-xs' onclick='addOneCourse(\""+result[i]['courseId']+"\",\""+result[i]['name']+"\")' value='点击选择'/></td>"+
                                "</tr>"
                            )
                        }
                })
            }
        }
    </script>
</head>
<body>
<div class="container">
    <div class="row clearfix">
        <div class="col-md-12 column">
            <nav class="navbar navbar-default" role="navigation">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1"> <span class="sr-only">Toggle navigation</span><span class="icon-bar"></span><span class="icon-bar"></span><span class="icon-bar"></span></button> <a class="navbar-brand" href="select.html">选课规划</a>
                </div>

                <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                    <ul class="nav navbar-nav">
                        <li class="active">
                            <a href="#">通过教学计划查找课程</a>
                        </li>
                        <li>
                            <a href="#">通过时间查找课程</a>
                        </li>
                    </ul>
                    <div class="navbar-form navbar-left" role="search">
                        <div class="form-group" id="courseNameDiv">
                            <input id = "inputCourseName" name = "courseName" type="text" placeholder="请输入课程名称" class="form-control" />
                        </div> <input type="button" class="btn btn-info" value="按名称查找" onclick="getCoursesByName(document.getElementById('inputCourseName').value)"/>
                    </div>
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#">注销</a>
                        </li>
                        <li class="dropdown">
                            <a href="#" class="dropdown-toggle" data-toggle="dropdown">Dropdown<strong class="caret"></strong></a>
                            <ul class="dropdown-menu">
                                <li>
                                    <a href="#">Action</a>
                                </li>
                                <li>
                                    <a href="#">Another action</a>
                                </li>
                                <li>
                                    <a href="#">Something else here</a>
                                </li>
                                <li class="divider">
                                </li>
                                <li>
                                    <a href="#">Separated link</a>
                                </li>
                            </ul>
                        </li>
                    </ul>
                </div>

            </nav>
        </div>
    </div>
    <div class="row clearfix">
        <div class="col-md-9 column">
            <div class="row clearfix">
                <div class="col-md-9 column">
                    <div class="row clearfix">
                        <div class="col-md-4 column">
                            <select class="form-control" id="gradeList" onchange="getMajorList(this.value)">
                                <option value="">请选择年级</option>
                                <option value="2015a">2015级</option>
                                <option value="2016a">2016级</option>
                                <option value="2017a">2017级</option>
                                <option value="2018a">2018级</option>
                            </select>
                        </div>
                        <div class="col-md-4 column">
                            <select id="majorList" class="form-control" disabled>
                                <option value="">选择专业（先选年级）</option>
                            </select>
                        </div>
                        <div class="col-md-4 column">
                            <select class="form-control" id="semester">
                                <option value="">选择学期</option>
                                <option value="1a">大一上</option>
                                <option value="1b">大一下</option>
                                <option value="2a">大二上</option>
                                <option value="2b">大二下</option>
                                <option value="3a">大三上</option>
                                <option value="3b">大三下</option>
                                <option value="4a">大四上</option>
                                <option value="4b">大四下</option>
                            </select>

                        </div>
                    </div>
                </div>
                <div class="col-md-3 column text-center">
                    <button type="button" class="btn btn-info" onclick="getCoursesByPlan(
                        document.getElementById('gradeList').value,
                        document.getElementById('majorList').value,
                        document.getElementById('semester').value)">
                        按教学计划查找
                    </button>
                </div>
            </div>
            <table class="table">
                <thead>
                <tr>
                    <th>
                        课程编号
                    </th>
                    <th>
                        课程名称
                    </th>
                    <th>
                        学分
                    </th>
                    <th>
                        开课学院
                    </th>
                    <th>
                        选择
                    </th>
                </tr>
                </thead>
                <tbody id="courseListForChoose">
                <tr class="text-center">
                    <td colspan="5">
                        <div class="alert alert-info">
                            课程搜索结果将在此处显示。
                        </div>
                    </td>
                </tr>

                </tbody>
            </table>
        </div>
        <div class="col-md-3 column text-center">
            <h3>
                已经选择的课程
            </h3>
            <table class="table">
                <thead>
                <tr>
                    <th>
                        序号
                    </th>
                    <th>
                        名称
                    </th>
                    <th>
                        操作
                    </th>
                </tr>
                </thead>
                <tbody id="chosenCourses">
                </tbody>
            </table>
            <button id="next" type="button" disabled class="btn btn-success">下一步</button>
        </div>
    </div>
</div>
</body>
</html>